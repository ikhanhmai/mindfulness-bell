# Data Model: App Store Publishing with EAS

**Branch**: `002-create-the-specification` | **Date**: 2025-09-27
**Source**: Extracted from feature specification and research findings

## Core Entities

### Build Configuration
**Purpose**: Manages EAS build settings and environment configurations

**Fields**:
- `profile: string` - Build profile identifier (development, preview, production)
- `platform: 'ios' | 'android'` - Target platform
- `resourceClass: 'small' | 'medium' | 'large'` - EAS resource allocation
- `image: string` - Build environment image (e.g., macos-sonoma-14.6-xcode-16.1)
- `node: string` - Node.js version specification
- `environment: Record<string, string>` - Environment variables
- `distribution: 'internal' | 'store'` - Distribution method

**Relationships**:
- References Apple Developer Assets for code signing
- Generates Build Artifacts as output

**Validation Rules**:
- Profile must be unique within project
- Production builds require 'store' distribution
- Resource class must align with build complexity

**State Transitions**:
```
Created → Validated → Building → Complete | Failed
```

### App Metadata
**Purpose**: Stores App Store submission information and app details

**Fields**:
- `name: string` - App display name
- `bundleIdentifier: string` - iOS bundle identifier (com.domain.app)
- `version: string` - App version (semantic versioning)
- `buildNumber: string` - iOS build number
- `description: string` - App Store description
- `keywords: string[]` - App Store search keywords
- `category: string` - Primary App Store category
- `privacyPolicyUrl: string` - Privacy policy URL
- `screenshots: Screenshot[]` - App Store screenshots

**Relationships**:
- Used by Release Workflow for submission
- Validated against Apple Developer Assets

**Validation Rules**:
- Bundle identifier must match provisioning profile
- Version must follow semantic versioning
- Description must be 170-4000 characters
- Keywords limited to 100 characters total
- Privacy policy URL required for wellness apps

### Apple Developer Assets
**Purpose**: Manages authentication and signing credentials

**Fields**:
- `teamId: string` - Apple Developer Team ID
- `ascApiKeyId: string` - App Store Connect API Key ID
- `ascApiKeyIssuerId: string` - API Key Issuer ID
- `ascApiKeyPath: string` - Path to private key file (.p8)
- `certificateType: 'development' | 'distribution'` - Certificate type
- `provisioningProfile: string` - Provisioning profile identifier

**Relationships**:
- Required by Build Configuration for signing
- Validates App Metadata bundle identifier

**Validation Rules**:
- API Key must have App Manager role minimum
- Private key file must exist and be readable
- Team ID must match provisioning profile
- Certificate must be valid and not expired

**Security Requirements**:
- Private key never stored in version control
- API credentials encrypted at rest
- Access logged for audit purposes

### Build Artifacts
**Purpose**: Tracks build outputs and submission files

**Fields**:
- `buildId: string` - Unique EAS build identifier
- `artifactUrl: string` - Download URL for IPA file
- `buildNumber: string` - Internal build number
- `size: number` - File size in bytes
- `createdAt: Date` - Build creation timestamp
- `expiresAt: Date` - Artifact expiration date
- `sourceMaps: string[]` - Source map file URLs
- `buildLogs: string` - Build log URL

**Relationships**:
- Generated by Build Configuration
- Used by Release Workflow for submission

**Validation Rules**:
- Build ID must be unique
- IPA file must be valid iOS application bundle
- Size must not exceed App Store limits (4GB)
- Source maps required for production builds

**Lifecycle**:
- Development builds: 30 days retention
- Production builds: Unlimited retention

### Release Workflow
**Purpose**: Orchestrates the build and submission process

**Fields**:
- `workflowId: string` - Unique workflow identifier
- `status: WorkflowStatus` - Current workflow state
- `buildConfiguration: BuildConfiguration` - Build settings
- `appMetadata: AppMetadata` - Submission metadata
- `buildArtifact?: BuildArtifact` - Generated build (if complete)
- `submissionId?: string` - App Store Connect submission ID
- `reviewStatus?: ReviewStatus` - App Store review state
- `createdAt: Date` - Workflow start time
- `updatedAt: Date` - Last status update

**Enums**:
```typescript
enum WorkflowStatus {
  INITIATED = 'initiated',
  BUILDING = 'building',
  BUILD_COMPLETE = 'build_complete',
  SUBMITTING = 'submitting',
  SUBMITTED = 'submitted',
  FAILED = 'failed'
}

enum ReviewStatus {
  WAITING_FOR_REVIEW = 'waiting_for_review',
  IN_REVIEW = 'in_review',
  REJECTED = 'rejected',
  APPROVED = 'approved',
  READY_FOR_SALE = 'ready_for_sale'
}
```

**State Transitions**:
```
INITIATED → BUILDING → BUILD_COMPLETE → SUBMITTING → SUBMITTED
         ↓           ↓                ↓            ↓
       FAILED ←——————————————————————————————————————————
```

**Validation Rules**:
- Status transitions must follow valid sequence
- Build configuration required before building
- App metadata required before submission
- Failed workflows require manual intervention

## Entity Relationships

```
Build Configuration ──→ Build Artifacts
       ↓                      ↓
Apple Developer Assets ──→ Release Workflow ←── App Metadata
```

## Data Storage Strategy

**Local Storage** (Primary):
- Build configurations in project files
- API credentials in secure local storage
- Build artifacts cached locally for development

**EAS Cloud Storage**:
- Build artifacts (temporary)
- Build logs and metadata
- Submission status tracking

**Security Considerations**:
- No credentials in version control
- API keys stored in secure environment variables
- Build artifacts auto-expire based on policy

## Error Handling

**Build Configuration Errors**:
- Invalid profile settings → Configuration validation failure
- Missing credentials → Authentication error
- Resource constraints → Build resource error

**Submission Errors**:
- Invalid metadata → Pre-submission validation failure
- App Store rejection → Manual review required status
- API rate limiting → Automatic retry with backoff

**Recovery Strategies**:
- Configuration errors: Validate before build initiation
- Build failures: Retry with exponential backoff
- Submission failures: Manual review workflow
- Credential expiry: Automated renewal notification

---
*Data model version: 1.0*
*Compatible with: EAS CLI v8.0.0+, App Store Connect API v3*